# Administrative Boundaries API

**API há»‡ thá»‘ng ranh giá»›i hÃ nh chÃ­nh Viá»‡t Nam** - Cung cáº¥p dá»¯ liá»‡u tá»‰nh/thÃ nh phá»‘, quáº­n/huyá»‡n, phÆ°á»ng/xÃ£ vá»›i kháº£ nÄƒng CRUD vÃ  Ä‘á»“ng bá»™ tá»± Ä‘á»™ng.

## ğŸ“‹ Tá»•ng quan dá»± Ã¡n

Dá»± Ã¡n nÃ y xÃ¢y dá»±ng má»™t **API RESTful** Ä‘á»ƒ quáº£n lÃ½ dá»¯ liá»‡u hÃ nh chÃ­nh Viá»‡t Nam, bao gá»“m:
- **34 tá»‰nh/thÃ nh phá»‘**
- **HÃ ng nghÃ¬n quáº­n/huyá»‡n** 
- **HÃ ng chá»¥c nghÃ¬n phÆ°á»ng/xÃ£**

Vá»›i kháº£ nÄƒng tÃ¬m kiáº¿m, chuyá»ƒn Ä‘á»•i Ä‘á»‹a chá»‰, quáº£n lÃ½ lá»‹ch sá»­ vÃ  Ä‘á»“ng bá»™ tá»± Ä‘á»™ng.

##  Kiáº¿n trÃºc há»‡ thá»‘ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   External API  â”‚    â”‚   Express API   â”‚    â”‚    MongoDB      â”‚
â”‚  (address-kit)  â”‚â”€â”€â”€â–¶â”‚    Server       â”‚â”€â”€â”€â–¶â”‚   Database      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   JSON Backup   â”‚
                       â”‚  (fallback)     â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##  Luá»“ng hoáº¡t Ä‘á»™ng chÃ­nh

### **1. Khá»Ÿi Ä‘á»™ng há»‡ thá»‘ng**
```bash
# CÃ i Ä‘áº·t dependencies
npm install

# Khá»Ÿi Ä‘á»™ng MongoDB (Windows)
net start MongoDB

# Cháº¡y server
npm run start
```

### **2. Fetch dá»¯ liá»‡u tá»« API**
```bash
# Láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« address-kit API
npm run fetch
```

### **3. Import vÃ o MongoDB**
```bash
# Import dá»¯ liá»‡u vÃ o database
npm run import-units
```

### **4. Cháº¡y cron job tá»± Ä‘á»™ng**
```bash
# Tá»± Ä‘á»™ng cáº­p nháº­t dá»¯ liá»‡u hÃ ng ngÃ y lÃºc 3:00 AM
npm run schedule
```

## ğŸ“‹ NPM Scripts & Commands

### **Development Commands**
```bash
npm start                    # Khá»Ÿi Ä‘á»™ng server (production mode)
npm run dev                  # Khá»Ÿi Ä‘á»™ng server (development mode)
npm run build                # Build project (náº¿u cÃ³)
```

### **Data Management Commands**
```bash
npm run fetch                # Fetch data tá»« external API
npm run import-units         # Import units vÃ o MongoDB
npm run import-address       # Import addresses vÃ o MongoDB
npm run schedule             # Cháº¡y cron job scheduler
```

### **ğŸ§ª Testing Commands**
```bash
npm test                     # Cháº¡y táº¥t cáº£ tests
npm run test:coverage        # Cháº¡y tests vá»›i coverage report
npm run test:watch           # Cháº¡y tests á»Ÿ watch mode
npm run test:performance     # Cháº¡y performance tests
npm run test:integration     # Cháº¡y integration tests
npm run test:server          # Cháº¡y server API tests
npm run test:middleware      # Cháº¡y middleware tests
npm run test:utils           # Cháº¡y utility tests
npm run test:scripts         # Cháº¡y script tests
npm run test:fetcher         # Cháº¡y fetcher tests
```

### **ğŸ”§ Utility Commands**
```bash
npm run lint                 # Lint code (náº¿u cÃ³)
npm run format               # Format code (náº¿u cÃ³)
npm run clean                # Clean build artifacts
npm run validate             # Validate project setup
```

### **ğŸ“Š Monitoring Commands**
```bash
npm run logs                 # Xem logs (náº¿u cÃ³)
npm run status               # Kiá»ƒm tra tráº¡ng thÃ¡i system
npm run health               # Health check
```

### **ğŸ—„ï¸ Database Commands**
```bash
npm run db:connect           # Káº¿t ná»‘i database
npm run db:disconnect        # Ngáº¯t káº¿t ná»‘i database
npm run db:seed              # Seed database vá»›i test data
npm run db:reset             # Reset database
npm run db:backup            # Backup database
```

### **ğŸ“ File Operations Commands**
```bash
npm run data:fetch           # Fetch data tá»« API
npm run data:import          # Import data vÃ o database
npm run data:export          # Export data tá»« database
npm run data:clean           # Clean data files
```

### **ğŸ” Debug Commands**
```bash
npm run debug                # Cháº¡y vá»›i debug mode
npm run debug:server         # Debug server
npm run debug:test           # Debug tests
npm run debug:performance    # Debug performance tests
```

## ğŸ“ Cáº¥u trÃºc dá»± Ã¡n chi tiáº¿t

### ğŸ—ï¸ **Root Level Files**
```
AdministrativeBoundaries/
â”œâ”€â”€ ğŸ“„ server.js                   # ğŸš€ Main server entry point
â”‚   â””â”€â”€ Khá»Ÿi Ä‘á»™ng Express server, káº¿t ná»‘i MongoDB, mount routes
â”œâ”€â”€ ğŸ“„ package.json                # ğŸ“¦ Dependencies & npm scripts
â”œâ”€â”€ ğŸ“„ jest.config.js              # âš™ï¸ Jest testing configuration
â”œâ”€â”€ ğŸ“„ jest.global-setup.js        # ğŸ”§ Jest global setup (MongoDB connection)
â”œâ”€â”€ ğŸ“„ jest.global-teardown.js     # ğŸ§¹ Jest global teardown (cleanup)
â”œâ”€â”€ ğŸ“„ jest.setup.js               # ğŸ› ï¸ Jest test setup utilities
â””â”€â”€ ğŸ“„ README.MD                   # ğŸ“š Project documentation
```

### ğŸ–¥ï¸ **Server Core** (`/server/`)
```
ğŸ“ server/
â”œâ”€â”€ ğŸ“„ index.js                    # ğŸ¯ Server configuration & startup
â”‚   â””â”€â”€ Express app setup, middleware, route mounting
â”‚
â”œâ”€â”€ ğŸ“ controllers/                # ğŸ® Business Logic Layer
â”‚   â”œâ”€â”€ ğŸ“„ provinceController.js   # ğŸ›ï¸ Xá»­ lÃ½ tá»‰nh/thÃ nh phá»‘
â”‚   â”‚   â””â”€â”€ GET /provinces, tÃ¬m kiáº¿m, lá»c dá»¯ liá»‡u
â”‚   â”œâ”€â”€ ğŸ“„ communeController.js    # ğŸ˜ï¸ Xá»­ lÃ½ xÃ£/phÆ°á»ng
â”‚   â”‚   â””â”€â”€ GET /communes, lá»c theo tá»‰nh, tÃ¬m kiáº¿m
â”‚   â”œâ”€â”€ ğŸ“„ unitController.js       # ğŸ”§ CRUD Ä‘Æ¡n vá»‹ hÃ nh chÃ­nh
â”‚   â”‚   â””â”€â”€ POST/PUT/DELETE/GET units, history tracking
â”‚   â”œâ”€â”€ ğŸ“„ convertController.js    # ğŸ”„ Chuyá»ƒn Ä‘á»•i Ä‘á»‹a chá»‰
â”‚   â”‚   â””â”€â”€ POST /convert, parse address string
â”‚   â”œâ”€â”€ ğŸ“„ searchController.js     # ğŸ” TÃ¬m kiáº¿m toÃ n diá»‡n
â”‚   â”‚   â””â”€â”€ GET /search, multi-field search
â”‚   â””â”€â”€ ğŸ“„ treeController.js       # ğŸŒ³ CÃ¢y phÃ¢n cáº¥p hÃ nh chÃ­nh
â”‚       â””â”€â”€ GET /tree, hierarchical data structure
â”‚
â”œâ”€â”€ ğŸ“ models/                     # ğŸ—„ï¸ Database Schemas
â”‚   â”œâ”€â”€ ğŸ“„ Unit.js                 # ğŸ“‹ Schema Ä‘Æ¡n vá»‹ hÃ nh chÃ­nh
â”‚   â”‚   â””â”€â”€ name, code, level, parentCode, timestamps
â”‚   â”œâ”€â”€ ğŸ“„ UnitHistory.js          # ğŸ“œ Schema lá»‹ch sá»­ thay Ä‘á»•i
â”‚   â”‚   â””â”€â”€ action, oldData, newData, changedAt
â”‚   â””â”€â”€ ğŸ“„ Address.js              # ğŸ  Schema Ä‘á»‹a chá»‰ (legacy)
â”‚       â””â”€â”€ address parsing vÃ  validation
â”‚
â”œâ”€â”€ ğŸ“ routes/                     # ğŸ›£ï¸ API Endpoints
â”‚   â”œâ”€â”€ ğŸ“„ provinces.js            # ğŸ›ï¸ /provinces endpoints
â”‚   â”‚   â””â”€â”€ GET /provinces, routing to provinceController
â”‚   â”œâ”€â”€ ğŸ“„ communes.js             # ğŸ˜ï¸ /communes endpoints
â”‚   â”‚   â””â”€â”€ GET /communes, GET /communes/:provinceID
â”‚   â”œâ”€â”€ ğŸ“„ units.js                # ğŸ”§ /units CRUD endpoints
â”‚   â”‚   â””â”€â”€ GET/POST/PUT/DELETE /units/:code, history, restore
â”‚   â”œâ”€â”€ ğŸ“„ convert.js              # ğŸ”„ /convert endpoints
â”‚   â”‚   â””â”€â”€ POST /convert, address conversion
â”‚   â”œâ”€â”€ ğŸ“„ search.js               # ğŸ” /search endpoints
â”‚   â”‚   â””â”€â”€ GET /search, multi-parameter search
â”‚   â””â”€â”€ ğŸ“„ tree.js                 # ğŸŒ³ /tree endpoints
â”‚       â””â”€â”€ GET /tree, hierarchical structure
â”‚
â”œâ”€â”€ ğŸ“ middleware/                 # ğŸ”§ Middleware Functions
â”‚   â”œâ”€â”€ ğŸ“„ validateUnit.js         # âœ… Input validation
â”‚   â”‚   â””â”€â”€ Validate unit data, required fields, data types
â”‚   â”œâ”€â”€ ğŸ“„ errorHandler.js         # âŒ Error handling
â”‚   â”‚   â””â”€â”€ Global error handler, 404 handler, error formatting
â”‚   â””â”€â”€ ğŸ“„ cacheMiddleware.js      # âš¡ Cache layer
â”‚       â””â”€â”€ Response caching, cache invalidation
â”‚
â”œâ”€â”€ ğŸ“ utils/                      # ğŸ› ï¸ Utility Functions
â”‚   â”œâ”€â”€ ğŸ“„ db.js                   # ğŸ—„ï¸ MongoDB connection
â”‚   â”‚   â””â”€â”€ Connect/disconnect, connection status
â”‚   â”œâ”€â”€ ğŸ“„ finder.js               # ğŸ” JSON search utilities
â”‚   â”‚   â””â”€â”€ Search functions for JSON data
â”‚   â”œâ”€â”€ ğŸ“„ loader.js               # ğŸ“¥ Data loading utilities
â”‚   â”‚   â””â”€â”€ Load data from files, parse JSON
â”‚   â””â”€â”€ ğŸ“„ response.js             # ğŸ“¤ Response formatting
â”‚       â””â”€â”€ Standardize API responses, error formatting
â”‚
â””â”€â”€ ğŸ“ scripts/                    # ğŸ“œ Import Scripts
    â”œâ”€â”€ ğŸ“„ importAddress.js        # ğŸ“¥ Import Ä‘á»‹a chá»‰ tá»« JSON
    â”‚   â””â”€â”€ Parse JSON, validate, import to MongoDB
    â””â”€â”€ ğŸ“„ importUnits.js          # ğŸ“¥ Import Ä‘Æ¡n vá»‹ tá»« JSON
        â””â”€â”€ Bulk import units, handle duplicates
```

### ğŸ“¥ **Data Fetching** (`/fetcher/`)
```
ğŸ“ fetcher/
â”œâ”€â”€ ğŸ“„ index.js                    # ğŸŒ Fetch data tá»« external API
â”‚   â””â”€â”€ HTTP requests to address-kit API, save to JSON
â””â”€â”€ ğŸ“„ schedule.js                 # â° Cron job scheduler
    â””â”€â”€ Daily fetch at 3:00 AM, logging, error handling
```

### ğŸ’¾ **Data Storage** (`/data/`)
```
ğŸ“ data/
â”œâ”€â”€ ğŸ“„ full-address.json           # ğŸ“‹ JSON backup data (30K+ records)
â”‚   â””â”€â”€ Complete administrative boundaries data
â”œâ”€â”€ ğŸ“„ fetch.log                   # ğŸ“ Fetch operation logs
â”‚   â””â”€â”€ Timestamp, success/failure, error details
â”œâ”€â”€ ğŸ“„ history.json                # ğŸ“œ Change history log
â”‚   â””â”€â”€ Track data modifications
â”œâ”€â”€ ğŸ“„ units.json                  # ğŸ¢ Units data (legacy)
â””â”€â”€ ğŸ“ snapshots/                  # ğŸ“¸ Historical data snapshots
    â””â”€â”€ Backup data for different dates
```

### ğŸ§ª **Test Suite** (`/tests/`)
```
ğŸ“ tests/
â”œâ”€â”€ ğŸ“ server/                     # ğŸ–¥ï¸ API Server Tests
â”‚   â”œâ”€â”€ ğŸ“„ provinces.test.js       # ğŸ›ï¸ Test province endpoints
â”‚   â”œâ”€â”€ ğŸ“„ communes.test.js        # ğŸ˜ï¸ Test commune endpoints
â”‚   â”œâ”€â”€ ğŸ“„ units.test.js           # ğŸ”§ Test unit CRUD operations
â”‚   â”œâ”€â”€ ğŸ“„ convert.test.js         # ğŸ”„ Test address conversion
â”‚   â”œâ”€â”€ ğŸ“„ search.test.js          # ğŸ” Test search functionality
â”‚   â”œâ”€â”€ ğŸ“„ tree.test.js            # ğŸŒ³ Test hierarchical data
â”‚   â””â”€â”€ ğŸ“„ history.test.js         # ğŸ“œ Test history tracking
â”‚
â”œâ”€â”€ ğŸ“ integration/                # ğŸ”— Integration Tests
â”‚   â”œâ”€â”€ ğŸ“„ fullFlow.test.js        # ğŸ”„ End-to-end workflow testing
â”‚   â””â”€â”€ ğŸ“„ syncJsonMongo.test.js   # ğŸ”„ JSON-MongoDB sync testing
â”‚
â”œâ”€â”€ ğŸ“ middleware/                 # ğŸ”§ Middleware Tests
â”‚   â”œâ”€â”€ ğŸ“„ validateUnit.test.js    # âœ… Test input validation
â”‚   â”œâ”€â”€ ğŸ“„ errorHandler.test.js    # âŒ Test error handling
â”‚   â””â”€â”€ ğŸ“„ cacheMiddleware.test.js # âš¡ Test caching
â”‚
â”œâ”€â”€ ğŸ“ utils/                      # ğŸ› ï¸ Utility Tests
â”‚   â”œâ”€â”€ ğŸ“„ db.test.js              # ğŸ—„ï¸ Test database connection
â”‚   â”œâ”€â”€ ğŸ“„ finder.test.js          # ğŸ” Test search utilities
â”‚   â”œâ”€â”€ ğŸ“„ loader.test.js          # ğŸ“¥ Test data loading
â”‚   â”œâ”€â”€ ğŸ“„ response.test.js        # ğŸ“¤ Test response formatting
â”‚   â”œâ”€â”€ ğŸ“„ file.test.js            # ğŸ“ Test file operations
â”‚   â””â”€â”€ ğŸ“„ logger.test.js          # ğŸ“ Test logging system
â”‚
â”œâ”€â”€ ğŸ“ scripts/                    # ğŸ“œ Script Tests
â”‚   â”œâ”€â”€ ğŸ“„ importAddress.test.js   # ğŸ“¥ Test address import
â”‚   â””â”€â”€ ğŸ“„ importUnits.test.js     # ğŸ“¥ Test units import
â”‚
â”œâ”€â”€ ğŸ“ fetcher/                    # ğŸŒ Fetcher Tests
â”‚   â”œâ”€â”€ ğŸ“„ index.test.js           # ğŸŒ Test data fetching
â”‚   â””â”€â”€ ğŸ“„ schedule.test.js        # â° Test cron scheduling
â”‚
â””â”€â”€ ğŸ“ performance/                # âš¡ Performance Tests
    â”œâ”€â”€ ğŸ“„ bulkInsert.test.js      # ğŸš€ Bulk operations performance
    â”œâ”€â”€ ğŸ“„ testController.js       # ğŸ® Test-specific controller
    â”œâ”€â”€ ğŸ“„ testRoutes.js           # ğŸ›£ï¸ Test-specific routes
    â””â”€â”€ ğŸ“„ test-summary.txt        # ğŸ“Š Performance test results
```

### ğŸ› ï¸ **Shared Utilities** (`/utils/`)
```
ğŸ“ utils/
â”œâ”€â”€ ğŸ“„ file.js                     # ğŸ“ File operations
â”‚   â””â”€â”€ Read/write files, path handling, file validation
â””â”€â”€ ğŸ“„ logger.js                   # ğŸ“ Logging system
    â””â”€â”€ Structured logging, log levels, file output
```

### ğŸ“Š **Coverage Reports** (`/coverage/`)
```
ğŸ“ coverage/
â”œâ”€â”€ ğŸ“„ clover.xml                  # ğŸ“Š Clover coverage report
â”œâ”€â”€ ğŸ“„ coverage-final.json         # ğŸ“Š JSON coverage data
â”œâ”€â”€ ğŸ“„ lcov.info                   # ğŸ“Š LCOV coverage format
â””â”€â”€ ğŸ“ lcov-report/                # ğŸ“Š HTML coverage reports
    â””â”€â”€ Interactive HTML coverage reports
```

### ğŸ“‹ **Configuration Files**
```
ğŸ“„ .env                           # âš™ï¸ Environment variables
ğŸ“„ .gitignore                     # ğŸš« Git ignore rules
ğŸ“„ docs.txt                       # ğŸ“š Additional documentation
ğŸ“„ tests.txt                      # ğŸ§ª Test documentation
```

## ğŸ”§ API Endpoints

### **Provinces (Tá»‰nh/ThÃ nh phá»‘)**
```http
GET /provinces
```
Tráº£ vá» danh sÃ¡ch táº¥t cáº£ tá»‰nh/thÃ nh phá»‘

### **Communes (XÃ£/PhÆ°á»ng)**
```http
GET /communes                    # Táº¥t cáº£ xÃ£/phÆ°á»ng
GET /communes/:provinceID        # XÃ£/phÆ°á»ng theo tá»‰nh
```

### **Units (CRUD Operations)**
```http
GET    /units                    # Danh sÃ¡ch Ä‘Æ¡n vá»‹
POST   /units                    # Táº¡o Ä‘Æ¡n vá»‹ má»›i
GET    /units/:code              # Chi tiáº¿t Ä‘Æ¡n vá»‹
PUT    /units/:code              # Cáº­p nháº­t Ä‘Æ¡n vá»‹
DELETE /units/:code              # XÃ³a Ä‘Æ¡n vá»‹
GET    /units/:code/history      # Lá»‹ch sá»­ thay Ä‘á»•i
POST   /units/:code/restore      # KhÃ´i phá»¥c tá»« lá»‹ch sá»­
```

### **Convert (Chuyá»ƒn Ä‘á»•i Ä‘á»‹a chá»‰)**
```http
POST /convert
Content-Type: application/json

{
  "address": "Tá»‰nh HÃ  Ná»™i, PhÆ°á»ng HoÃ n Kiáº¿m"
}
```

### **Search (TÃ¬m kiáº¿m)**
```http
GET /search?name=HÃ  Ná»™i&level=province
```

### **Tree (CÃ¢y phÃ¢n cáº¥p)**
```http
GET /tree
```

## ğŸ—„ï¸ Database Schema

### **Unit Collection**
```javascript
{
  name: String,                    // TÃªn Ä‘Æ¡n vá»‹
  code: String (unique),          // MÃ£ Ä‘Æ¡n vá»‹
  level: String,                  // Cáº¥p: province/district/commune
  parentCode: String,             // MÃ£ Ä‘Æ¡n vá»‹ cha
  provinceCode: String,           // MÃ£ tá»‰nh
  provinceName: String,           // TÃªn tá»‰nh
  boundary: Object,              // Ranh giá»›i Ä‘á»‹a lÃ½
  createdAt: Date,
  updatedAt: Date,
  history: Array                  // Lá»‹ch sá»­ thay Ä‘á»•i
}
```

### **UnitHistory Collection**
```javascript
{
  code: String,                   // MÃ£ Ä‘Æ¡n vá»‹
  action: String,                 // create/update/delete/restore
  oldData: Object,                // Dá»¯ liá»‡u cÅ©
  newData: Object,                // Dá»¯ liá»‡u má»›i
  changedAt: Date,                // Thá»i Ä‘iá»ƒm thay Ä‘á»•i
  changedBy: String,               // NgÆ°á»i thay Ä‘á»•i
  deleted: Boolean                // ÄÃ¡nh dáº¥u xÃ³a
}
```

## âš™ï¸ Cáº¥u hÃ¬nh mÃ´i trÆ°á»ng

Táº¡o file `.env`:
```env
# MongoDB
MONGODB_URI=mongodb://127.0.0.1:27017/administrative_boundaries

# API Configuration
API_BASE=https://production.cas.so/address-kit
EFFECTIVE_DATE=latest

# Server
PORT=3000
```

## ğŸ§ª Testing

### **Cháº¡y tests**
```bash
# Cháº¡y táº¥t cáº£ tests
npm test

# Cháº¡y vá»›i coverage
npm run test:coverage

# Cháº¡y test cá»¥ thá»ƒ
npm test -- --testNamePattern="Units API"
```

### **Test Coverage**
- **Server APIs**: 100% coverage cho controllers
- **Middleware**: Validation, error handling
- **Utils**: File operations, database
- **Integration**: Full flow testing
- **Performance**: Bulk operations

## ğŸ“Š Monitoring & Logging

### **Log Files**
- `data/fetch.log` - Log fetch operations
- Console logs vá»›i timestamp

### **Health Check**
```http
GET /
```
Tráº£ vá» tráº¡ng thÃ¡i API vÃ  danh sÃ¡ch endpoints

## ğŸ”„ Data Flow & Component Interactions

### **1. ğŸŒ Data Fetching Process**
```
External API (address-kit) 
    â†“ HTTP Request
fetcher/index.js 
    â†“ Parse & Validate
data/full-address.json (30K+ records)
    â†“ Log
data/fetch.log
```

**Chi tiáº¿t:**
- `fetcher/index.js`: HTTP GET request Ä‘áº¿n address-kit API
- Parse JSON response, validate data structure
- Save to `data/full-address.json` vá»›i formatting
- Log success/failure to `data/fetch.log`

### **2. ğŸ“¥ Data Import Process**
```
data/full-address.json
    â†“ Parse & Validate
server/scripts/importUnits.js
    â†“ Bulk Insert
MongoDB (Unit Collection)
    â†“ Create History
MongoDB (UnitHistory Collection)
```

**Chi tiáº¿t:**
- `importUnits.js`: Read JSON file, validate data
- Bulk insert vÃ o MongoDB vá»›i error handling
- Táº¡o history records cho má»—i unit
- Handle duplicates vÃ  data conflicts

### **3. ğŸ–¥ï¸ API Request Flow**
```
Client Request
    â†“ Express Router
server/routes/*.js
    â†“ Middleware
server/middleware/validateUnit.js
    â†“ Business Logic
server/controllers/*.js
    â†“ Database Query
MongoDB/JSON Fallback
    â†“ Response Format
server/utils/response.js
    â†“ Client Response
```

**Chi tiáº¿t:**
- Routes: Route matching vÃ  parameter extraction
- Middleware: Input validation, authentication, caching
- Controllers: Business logic, data processing
- Database: Primary MongoDB, JSON fallback
- Response: Standardized format, error handling

### **4. â° Auto Sync Process**
```
Cron Job (3:00 AM)
    â†“ Schedule
fetcher/schedule.js
    â†“ Fetch New Data
fetcher/index.js
    â†“ Update JSON
data/full-address.json
    â†“ Sync Database
server/scripts/importUnits.js
    â†“ Update MongoDB
MongoDB Collections
```

**Chi tiáº¿t:**
- `schedule.js`: Cron job setup, error handling
- Daily fetch at 3:00 AM vá»›i retry logic
- Update JSON file vá»›i new data
- Sync changes to MongoDB
- Log all operations

### **5. ğŸ§ª Test Execution Flow**
```
Jest Test Runner
    â†“ Setup
jest.global-setup.js (MongoDB connection)
    â†“ Test Execution
tests/*/**.test.js
    â†“ Mock/Real Data
MongoMemoryServer (in-memory DB)
    â†“ Cleanup
jest.global-teardown.js
```

**Chi tiáº¿t:**
- Global setup: Connect to in-memory MongoDB
- Test execution: Isolated test environment
- Mock data: Test-specific data generation
- Cleanup: Database cleanup after each test

### **6. ğŸ“Š Performance Testing Flow**
```
Performance Test Suite
    â†“ Test Controller
tests/performance/testController.js
    â†“ Test Routes
tests/performance/testRoutes.js
    â†“ MongoDB Operations
MongoMemoryServer
    â†“ Metrics Collection
Performance Reports
```

**Chi tiáº¿t:**
- Test-specific controller: MongoDB-only operations
- Test routes: Simplified routing logic
- Performance metrics: Timing, memory usage
- Reports: Detailed performance analysis

## ğŸš€ Deployment

### **Production Setup**
1. **MongoDB**: CÃ i Ä‘áº·t vÃ  khá»Ÿi Ä‘á»™ng MongoDB
2. **Environment**: Cáº¥u hÃ¬nh `.env` file
3. **Data**: Cháº¡y `npm run fetch` Ä‘á»ƒ láº¥y dá»¯ liá»‡u
4. **Import**: Cháº¡y `npm run import-units` Ä‘á»ƒ import vÃ o DB
5. **Server**: Cháº¡y `npm run start` Ä‘á»ƒ khá»Ÿi Ä‘á»™ng API
6. **Cron**: Cháº¡y `npm run schedule` Ä‘á»ƒ tá»± Ä‘á»™ng cáº­p nháº­t

### **Docker Support** (TÃ¹y chá»n)
```dockerfile
FROM node:18
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 3000
CMD ["npm", "start"]
```

## ğŸ“ˆ Performance

### **Optimizations**
- **Dual Storage**: MongoDB + JSON fallback
- **Indexing**: MongoDB indexes cho tÃ¬m kiáº¿m nhanh
- **Caching**: Middleware cache cho requests
- **Bulk Operations**: Batch insert/update

### **Benchmarks**
- **API Response**: < 100ms cho simple queries
- **Bulk Import**: ~1000 records/second
- **Search**: < 50ms vá»›i MongoDB indexes

## ğŸ”’ Security

### **Input Validation**
- Validate táº¥t cáº£ input parameters
- Sanitize string inputs
- Check data types vÃ  formats

### **Error Handling**
- Global error handler
- Structured error responses
- Logging táº¥t cáº£ errors

## ğŸ“ Changelog

### **v1.0.0** (Current)
- âœ… Core API endpoints
- âœ… MongoDB integration
- âœ… CRUD operations vá»›i history
- âœ… Auto sync vá»›i cron job
- âœ… Comprehensive testing
- âœ… JSON fallback system

## ğŸ¤ Contributing

1. Fork repository
2. Táº¡o feature branch
3. Commit changes
4. Push to branch
5. Táº¡o Pull Request

## ğŸ“„ License

ISC License

## ğŸ‘¥ Support

- **Issues**: Táº¡o issue trÃªn GitHub
- **Documentation**: Xem `docs.txt` cho chi tiáº¿t
- **API Docs**: Cháº¡y server vÃ  truy cáº­p `http://localhost:3000`

---

**ğŸŒ Administrative Boundaries API** - Quáº£n lÃ½ dá»¯ liá»‡u hÃ nh chÃ­nh Viá»‡t Nam má»™t cÃ¡ch hiá»‡u quáº£ vÃ  tin cáº­y.